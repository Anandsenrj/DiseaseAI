<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Disease Finder ‚Äî Smooth Animated</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    .page-enter { animation: fadeSlide 0.6s ease both; }
    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    body {
      background: linear-gradient(180deg, #e6f0ff, #fafbff);
      font-family: Inter, sans-serif;
    }
    .glass {
      background: rgba(255,255,255,0.88);
      border: 1px solid rgba(255,255,255,0.5);
      backdrop-filter: blur(12px);
    }
    .float-soft:hover {
      transform: translateY(-6px) scale(1.01);
      transition: .3s;
      box-shadow: 0 12px 30px rgba(0,0,0,0.2);
    }
    .input-animate:focus {
      transform: scale(1.02);
      box-shadow: 0 0 0 3px rgba(99,102,241,0.4);
      transition: 0.3s;
    }
    .img-float {
      animation: floatImg 4s ease-in-out infinite;
    }
    @keyframes floatImg {
      0% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }
  </style>
</head>

<body class="page-enter">

  <div class="max-w-4xl mx-auto p-6">

    <div class="flex justify-between items-center mb-6">
      <h1 class="text-4xl font-bold text-slate-900">
        Disease Finder <span class="text-indigo-600">AI</span>
      </h1>

      <button id="pdfBtn"
        class="bg-indigo-600 text-white px-4 py-2 rounded-lg shadow hover:bg-indigo-700 transition">
        Save PDF
      </button>
    </div>

    <input id="query"
      class="w-full p-4 rounded-xl border glass text-slate-900 outline-none input-animate"
      placeholder="Type disease name‚Ä¶"
    />

    <button onclick="searchDisease()"
      class="w-full mt-3 bg-indigo-600 text-white font-semibold p-3 rounded-xl hover:bg-indigo-700 transition">
      üîç Search Disease
    </button>

    <div id="output" class="mt-6 glass p-6 rounded-2xl">
      <p class="text-center text-slate-600">Search a disease to see full medical details.</p>
    </div>

  </div>

<script>
async function searchDisease() {
  const q = document.getElementById("query").value.trim();
  const out = document.getElementById("output");

  if (!q) return alert("Enter a disease name.");

  out.innerHTML = `<p class='text-center'>‚è≥ Fetching Wikipedia‚Ä¶</p>`;

  // Wikipedia summary
  const wikipedia = await fetch(
    "https://en.wikipedia.org/api/rest_v1/page/summary/" + encodeURIComponent(q)
  );

  if (!wikipedia.ok) {
    out.innerHTML = `<p class='text-center text-red-600'>Disease not found.</p>`;
    return;
  }

  const summary = await wikipedia.json();
  const img = summary.thumbnail?.source || "";

  out.innerHTML = `<p class='text-center'>‚öïÔ∏è Analyzing medical data‚Ä¶</p>`;

  // Call backend NLP
  const ai = await (await fetch("/api/extract", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      combinedText: summary.extract
    })
  })).json();

  function sectionBlock(title, items) {
    if (!items || !items.length) return "";
    return `
      <div class="mb-4">
        <h3 class="font-semibold text-indigo-600 text-lg">${title}</h3>
        <ul class="list-disc ml-5 text-sm leading-relaxed">
          ${items.map(x => `<li>${x}</li>`).join("")}
        </ul>
      </div>
    `;
  }

  out.innerHTML = `
    <div id="reportCard" class="grid md:grid-cols-3 gap-4 bg-white/80 p-4 rounded-xl shadow float-soft">

      <div class="text-center md:border-r pr-4">
        ${img 
          ? `<img src="${img}" class="disease-img img-float mb-3 rounded-xl shadow" />`
          : `<div class="w-32 h-32 bg-gray-300 rounded-xl mb-3 mx-auto"></div>`
        }

        <h2 class="text-xl font-semibold">${summary.title}</h2>

        <a href="${summary.content_urls.desktop.page}" class="text-indigo-600 underline text-sm" target="_blank">
          View on Wikipedia
        </a>

        <p class="text-sm mt-3 text-slate-600">${summary.extract}</p>
      </div>

      <div class="md:col-span-2 pl-4">
        ${sectionBlock("Symptoms", ai.symptoms)}
        ${sectionBlock("Causes", ai.causes)}
        ${sectionBlock("Risk Factors", ai.risk_factors)}
        ${sectionBlock("Diagnosis", ai.diagnosis)}
        ${sectionBlock("Complications", ai.complications)}
        ${sectionBlock("Treatments", ai.treatments)}
        ${sectionBlock("Prevention", ai.prevention)}

        <div class="mt-4">
          <h3 class="font-semibold text-indigo-600 text-lg">When to See a Doctor</h3>
          <p class="text-sm text-slate-700">${ai.when_to_see_a_doctor}</p>
        </div>
      </div>

    </div>
  `;
}


// ---------------- PDF EXPORT ----------------
document.getElementById("pdfBtn").onclick = async () => {
  const card = document.getElementById("reportCard");
  if (!card) return alert("Search a disease first!");

  const canvas = await html2canvas(card, { scale: 2 });
  const img = canvas.toDataURL("image/png");

  const pdf = new jspdf.jsPDF("p", "mm", "a4");
  pdf.addImage(img, "PNG", 10, 10, 190, (canvas.height * 190) / canvas.width);
  pdf.save("Disease_Report.pdf");
};
</script>

</body>
</html>
